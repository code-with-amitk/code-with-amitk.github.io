<!DOCTYPE html>
<html>
<head>
    <title>Interrupts</title>
    <link rel="stylesheet" href="/css/styles.css"/>
    <link rel="stylesheet" href="/css/prism.css"/>
    <!-- Add any necessary CSS and JavaScript files -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <nav class="navbar">    <!--See .navbar in styles.css-->
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="#">Our team</a></li>
          <li><a href="#">Projects</a></li>
          <li><a href="#">Contact</a></li>
          <li>
            <form>
                <input type="search" name="q" placeholder="Search site" />
                <input type="submit" value="Go!" />
            </form>
           </li>
        </ul>
    </nav>

    <aside class="sidebar">   <!-- Sidebar -->
        <a href="#what">What is interrupt</a>
        <a href="#flow">Interrupt Flow</a>
        <a href="#ivt">Interrupt Vector Table</a>
        <ul>
            <li><a href="#probing">Probing</a></li>
        </ul>
    </aside>

    <article style="margin-left:200px;">
        <h2 id="what">What is Interrupt</h2>
        <dl>
            Interrupt is <b>event/signals generated by H/W(Eg: clock, keyboard) or S/W which is sent to CPU</b> by Interrupt Controller.<br>
            Interrupts are used to handle asynchronous events, CPU pauses the current execution, address the event, and then resume its previous activity.<br>
            CPU is asked to perform some high priority task wrt what its doing.<br>
            Interrupts can be triggered by hardware devices (hardware interrupts) or by software instructions (software interrupts).<br>
            Information from interrupt is converted to character and stored in buffer to be later used by ISR.
        </dl>

        <h2 id="flow">Interrupt Flow/Hardware Interrupt reaching CPU</h2>
        <table class="image-table">
            <tr>
                <td>
                    <dl><strong><a href="/Motherboard/Memory/Processes.html#processtable">Process Control Block(PCB)</a></strong></dl>
                    <div class="image-container">
                        <img 
                      src="//www.plantuml.com/plantuml/png/XP9FSnen3CNl_XIQS6aFcTuvT09asiaqoJ2GzCJ5U1LGsRLS_u7oxIijBDbja_R2Cl9FxqdFladPnboQsWJvagDWVORdX15iWZAeViFZb6siPknpvBe-CJitW08vhLxD8s-YRHgxhd7bxtp664l8hxrNWpONIjiscpyB_VYqWFdTun1PJ1uK4T6XeLjtXWvJMlcp1KnhThihWD7aPx635jhdjkKorSf_HvSvmfEEExIb5F-4bnZtv10MN39vuOtdZC1xZ51WD3jQRze8GssFv3VGy9xGX2ZpOGKxF09x8v-rncdGLw02nXIu_Yo1ZZLgEEDcvxGQIChRJmUWRew-gwO-kgVDDi_9xymjEgfG58WZvQEPf4GR_zeAr7SDf0vw1UBmZe7Up-WhrvLaKnAUDchtkmYzZI_j7c4-WypoE-t1YkXURZs65gfiji1UiRwK0EPMZv90LGTSo--7S7fZuBZep1-bkimsbmGBt52Iqjz-SlTZ-49IreijIQz7qf3o9OExvHFOgjButzxfdgseua78nMcn_uGmswBRmM5BRWlnF5eoauYYWfLijJwgrh_IwThUIKYPziMWppqBzeFKEra9RGopY3PZkqVALkPxuQXJ3A1srKSyhBoSTAaCY1-b2P1PutmhDM5WD4NQe16_wdJBBv4RkBn_LSPVw4eczk2u2JLcV3VISwOBJ9d5JHTiLSt3vKskTHqvAqrVvaR-bgR-3G00"
                      alt="Interrupt flow" class="zoomable-image" id="zoomableImage1">
                    </div>
                      <pre class="puml" visibility: hidden>
                        @startuml
                        participant User as u
                        participant KeyBoardController as kc
                        participant pic as "Programmable\nInterruptController"
                        participant cpu as "CPU\nINTR PIN"
                        participant RAM as ram
                        participant pcb as "Process\nControl Block"  #Aqua
                        participant ivt as "Interrupt\nVector Table"
                        participant isr as "Interrupt\nService Routine"
                        
                        note over u #Cyan
                        User playing movie
                        pressed key on
                        keyboard
                        end note
                        
                        u -> kc: Key pressed
                        kc -> pic: h/w interrupt
                        
                        note over pic #LightPink
                        Decide priority
                        Assign interrupt id
                        end note
                        
                        pic -> cpu: hw interrupt
                        
                        note over cpu #Gold
                        pause movie play
                        end note
                        
                        note over cpu #Gold
                        Save PC to PCB
                        end note
                        
                        cpu -> pcb: Save data on PCB
                        
                        note over pcb
                        Data saved on PCB
                        - PC(program counter)
                        - Status Register
                        end note
                        
                        cpu -> ivt: Find isr using id
                        ivt -> cpu: IST address
                        
                        note over cpu #Gold
                        Load new ISR to PC
                        end note
                        
                        note over cpu #Gold
                        Check which registers
                        Are needed by ISR
                        end note
                        
                        cpu -> pcb: Save register on PCB
                        
                        note over pcb
                        Save present registers
                        on PCB
                        end note
                        cpu -> ram: Create new stack for ISR
                        cpu -> ram: Load New\nISR address
                        cpu -> ram: jump to isr address
                        
                        note over ram #Beige
                        read data from keyboard
                        ISR execution complete
                        end note
                        
                        note over cpu  #Gold
                        Restores PCB data
                        Movie playback resume
                        end note
                        
                        @enduml
                      </pre>
                </td>
                <td>
                    <div class="image-container">
                    <img src="/images/Interrupts/interrupt_flow.jpg" alt="Interrupt flow1" class="zoomable-image" id="zoomableImage2">
                    </div>                    
                </td>
            </tr>
        </table>

        <h2 id="ivt">IVT(Interrupt Vector Table) / (IDT) Interrupt Descriptor Table</h2>
        <dl>
        Contains ISR(Interrupt service routine)/Handler Address to which CPU jumps at occurrence of interrupt. 
        Present in 1st 1K of physical memory.<br>
        Starting address of IVT is stored in dedicated register (IDTR).<br>
        IVT is created when the system initially boots and reflects the specific system configuration.<br>
        IVT is filled using <b><a href="#probing">Probing</a></b><br>
        Interrupt number is used as index in IVT. CPU goes to IVT's index, gets Instruction Pointer/Program counter and starts 
        Interrupt service procedure. Once CPU starts ISP, Device Acks Interrupt controller
        </dl>
        <pre><code class="language-css">
            | 0x420932 ISR of Int0 |      |     |     |
Interrupt No>       0                 1       2     3

    CPU                    Hardware_Device
       <- Interrupt3=signal-
 Find & runs ISR3 for Intr3
    isr3(){..}
        </code></pre>

        <h4 id="probing">Probing</h4>
        <dl>
        Finding which Interrupt line Hardware Device is going to use?<br>
        Device driver tells the Hardware device to generate interrupts and watches the IRQ line and 
        finds which line device is using.<br>
        <pre><code class="language-css">
            unsigned long probe_irq_on(void);
        </code></pre>
        This function returns a bit maskof unassigned interrupts.<br>
        The driver must preserve the returned bit mask, and pass it to probe_irq_off later.<br>
        Other Method? The interrupt handler can be installed either at driver initialization or when the device 
        is first opened. Installing isr at device initialization causes interrupt line to be occupied even device is not used.
        </dl>

    </article>

    <script src="/scripts/common.js"></script>
    <script src="/scripts/prism.js"></script>
</body>
</html>